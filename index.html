<!DOCTYPE html><html lang="ja"><head>
<meta charset="utf-8" />
<title>福岡 衆院小選挙区 チラシ配布状況</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
/* —— 省略可：配色だけ調整 —— */
:root{--bg:linear-gradient(135deg,#ff9a9e 0%,#fecfef 50%,#fecfef 100%);
--card:rgba(255,255,255,.95);--accent:#ff6b6b;--fg:#2c3e50;--border:rgba(255,107,107,.3)}
html,body{margin:0;height:100%;background:var(--bg);font-family:"Comic Sans MS","メイリオ",sans-serif;color:var(--fg);font-weight:600}
#map{height:100%;width:100%}.title{position:absolute;top:10px;left:50%;transform:translateX(-50%);
background:var(--card);padding:12px 24px;border-radius:24px;border:2px solid var(--border);
box-shadow:0 4px 15px rgba(255,107,107,.3);color:var(--accent);z-index:1000;font-size:1.15rem;
backdrop-filter:blur(10px);text-align:center}
.legend{background:var(--card);line-height:1.6em;padding:12px 18px;font-size:1rem;border-radius:18px;
border:2px solid var(--border);box-shadow:0 4px 18px rgba(255,107,107,.25);backdrop-filter:blur(10px)}
.legend i{width:18px;height:18px;float:left;margin-right:8px;border-radius:50%;border:2px solid rgba(255,107,107,.4)}
.leaflet-tooltip{background:var(--card)!important;border:2px solid var(--border)!important;border-radius:10px!important;
color:var(--fg)!important;font-weight:bold!important;box-shadow:0 3px 10px rgba(255,107,107,.3)!important}
</style></head><body>
<div class="title">「安価安心で食べたいから政権もいただきます」<br>チラシ配布状況（福岡 11 選挙区）</div>
<div id="map"></div>

<!-- Leaflet & shpjs -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shpjs/6.1.0/shp.min.js"></script>

<script>
/* ===== 1. Leaflet 初期化 ===== */
const map = L.map("map",{zoomSnap:.25,zoomControl:false})
  .setView([33.58,130.58],8.6);
L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
  {attribution:"&copy;OpenStreetMap &amp; CARTO"}).addTo(map);
L.control.zoom({position:"bottomleft"}).addTo(map);

/* ===== 2. 配布状況テーブル ===== */
const districtStatus = {
  "福岡1区":"completed",
  "福岡2区":"none",
  "福岡3区":"planned",
  "福岡4区":"none",
  "福岡5区":"none",
  "福岡6区":"none",
  "福岡7区":"none",
  "福岡8区":"none",
  "福岡9区":"none",
  "福岡10区":"none",
  "福岡11区":"none"
};

/* ===== 3. Shapefile → GeoJSON 読込 ===== */
const shpUrl = "https://gtfs-gis.jp/senkyoku/byku/senkyoku289polygon_byku_40.zip"; // 福岡県のみ
shp(shpUrl).then(fc=>{
  const layer = L.geoJSON(fc,{
    style:f=>styleByStatus(f),
    onEachFeature:(f,l)=>tooltipAndHover(f,l)
  }).addTo(map);
  map.fitBounds(layer.getBounds());
});

/* ===== 4. スタイル関数 ===== */
function styleByStatus(feature){
  const name = feature.properties.KU || feature.properties.NAME || ""; // 属性名は環境により異なる
  const status = districtStatus[name]||"none";
  const colors = {completed:"#ff4757",planned:"#ffa502",none:"#a4b0be"};
  return {weight:2,color:"#ff6b6b",fillOpacity:.75,fillColor:colors[status]};
}

/* ===== 5. Tooltip & Hover ===== */
function tooltipAndHover(feature,layer){
  const name = feature.properties.KU || feature.properties.NAME || "";
  const st = districtStatus[name]||"none";
  const label = {completed:"✅ 配布済み",planned:"📋 配布予定",none:"❌ 未配布"}[st];
  layer.bindTooltip(`${name}<br><strong>${label}</strong>`,{sticky:true});
  layer.on({
    mouseover:e=>e.target.setStyle({weight:4,color:"#ff4757",fillOpacity:.9}),
    mouseout:e=>e.target.setStyle({weight:2,color:"#ff6b6b",fillOpacity:.75})
  });
}

/* ===== 6. 凡例 ===== */
L.control({position:"bottomright"}).onAdd=_=>{
  const d=document.createElement("div");d.className="legend";
  d.innerHTML=`
    <strong>🗳️ 配布状況</strong><br>
    <i style="background:#ff4757"></i> ✅ 配布済み<br>
    <i style="background:#ffa502"></i> 📋 配布予定<br>
    <i style="background:#a4b0be"></i> ❌ 未配布<br>`;
  return d;
}.addTo(map);
</script>
</body></html>
